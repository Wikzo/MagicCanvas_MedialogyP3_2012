\section{Camera theory}

An image captured through a camera is the result of reflected light being detected on a camera sensor, see figure \ref{fig:light_cam}. This process is know as \textit{image acquisition}. The process is generally not something you think about when you capture an image with a camera, since it all happens automatically. In this section the basics of image acquisition using a digital camera will be explained. But in order to understand how this works it is necessary to have a basic understanding of the physics behind light.

\begin{figure}[htbp] 
\centering 
\includegraphics[width=0.5\textwidth]{Pictures/Theory/light_from_sun.png} 
\caption{Light as captured by a camera} 
\label{fig:light_cam} 
\end{figure}

Light is a form of electromagnetic radiation that can be viewed as both waves and particles. This duality is however not something that will be covered within this chapter, as the wave model is sufficient to build the foundation of the understanding we need. A light wave is a small packet of energy travelling through space. These energy packets are known as photons. Photons can be described by three properties:

\begin{itemize}
\item \textbf{Wavelenght} - Measured in meters from wave top to wave top and denoted as $\lambda$.
\item \textbf{Frequency} - Measured in oscillations per second, Hz, denoted $f$.
\item \textbf{Energy} - Measured in electronvolts, eV, denoted $E$.
\end{itemize}

The formulas for these properties are as follows:
\begin{itemize}
\item To derive the wavelength or the frequency, formula \ref{eq:wavelenght} is applied:
\begin{align}
\centering 
\lambda = \frac{C}{f}
\label{eq:wavelenght} 
\end{align}
where {$C$} is the speed of light.
\item The second equation, equation \ref{eq:e_v}, describes the energy:
\begin{align}
\centering
E = \frac{hC}{\lambda}
\label{eq:e_v} 
\end{align}
Where {$h$} is Planck's constant, which describes the proportional relationship between the energy of a photon and the frequency of the corresponding electromagnetic wave.
\end{itemize}

The wavelength of the photon determines what color will be perceived. As known from physics, the speed of light is constant, thus changing the frequency will alter the wavelength and therefore the perceived color. The visible spectrum of light is only a fraction of the full spectrum of electromagnetic radiation, see figure \ref{fig:em_rad}. Light interacts additively, with a mix of equal parts of each wavelength resulting in white light. The light from the sun can be broken down into its component wavelengths by refracting the light in a prism. This yields the full spectrum of visible light, as seen in a rainbow.

\begin{figure}[htbp] 
\centering 
\includegraphics[width=1\textwidth]{Pictures/Theory/em_rad.png} 
\caption{Figure illustrating the full spectrum of electromagnetic radiation.} 
\label{fig:em_rad} 
\end{figure}

\subsection{Digital image acquisition}
When capturing an image using a digital camera, light passes through a lens onto the sensor. This acts in much the same way as the human eye, in place of cones sensitive to specific wavelengths, a camera sensor has a physical matrix of pixel sensors (one for each pixel in the output image). A camera that can only capture black and white images has only one type of sensor in each physical pixel whereas a camera that can capture color images has three types of sensors in each pixel\citep{ip_book}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PRACTICAL LIGHTING PART %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Image acquisition in the project}
In the project, two cameras were considered: a normal RGB web camera and a similar camera with an infrared (IR) filter installed. The filter consists of a small strip of normal analogue film, used for analogue pictures. The film strip allows only infrared light to pass, thus making the only light that reaches the sensor infrared. This is interesting, as it enables a larger degree of control over the illumination in the scene that is captured. Normally in a scene, controlling the lighting can prove a challenge, and in order to operate without error an image processing algorithm would have to take into account the variance in lighting that occurs naturally during a day cycle \citep{ip_book}. Working with infrared light helps to avoid this problem.


\begin{figure}[htbp] 
\centering 
\includegraphics[width=0.5\textwidth]{Pictures/Theory/IR_filter.png} 
\caption{Figure illustrating how the IR filter only allows infrared light to pass.} 
\label{fig:ir_filter} 
\end{figure}

\fxnote{CORRECT THE GOD DAMN PICTURE}

%\subsection{Infrared light}
%Infrared light lies right next to visible light in the electromagnetic spectrum, see figure \ref{fig:em_rad}. It can be used to illuminate things without having a visible component to the light, but this requires a device able to capture IR. %Some cameras are able to do this. A camera is designed to capture what a human eye can see, so in more expensive cameras infrared light is filtered out.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PRACTICAL LIGHTING PART %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Illuminating the scene}

It is important that the lighting in the scene is constant. Figure \ref{fig:scene_light} illustrates the same scene captured at different illuminations. Imagine a program that is intended to find the shelves in the image. Before any segmentation is applied, the image is converted to grayscale. Then the image is segmented using a threshold. In figure \ref{fig:scene_thresholded} the output is displayed. It is easy for the imaginary program to find the shelves in the right image, but not possible in the left, due to the difference in illumination.  

\begin{figure}[htbp] 
\centering 
\includegraphics[width=0.5\textwidth]{Pictures/HjoerringLibrary/scene_lighting.png} 
\caption{The difference in illumination on different times of day is clearly visible when compared next to each other.} 
\label{fig:scene_light} 
\end{figure}

\begin{figure}[htbp] 
\centering 
\includegraphics[width=0.5\textwidth]{Pictures/HjoerringLibrary/scene_lighting_thresholded.png} 
\caption{The same image converted to 8-bit grayscale and thresholded.} 
\label{fig:scene_thresholded} 
\end{figure}

To avoid running into issues with variances in the illumination, it was decided to illuminate the scene artificially. Different options were evaluated for the illumination, all under the consideration of having the ability to filter the camera input, allowing only infrared light through. The following options were considered:

\begin{itemize}
\item Using the library's lighting.
\item Making adjustments to the lighting at the library.
\item Bringing normal lights to light the scene.
\item Building our own light system to light the scene.
\end{itemize}

The library's lightning consist on two different types of lamps: fluorescent lights and halogen spots. The problem when using the infrared camera in that scenario, was that the normal lighting and the halogen spots radiated too much IR light. This impeded having a decent contrast between background and the subject to track.

To be able to have a higher contrast between the persons and the background, it was considered to redirect the light. It either could be by pointing to the background (the canvas, in this situation) or the visitors. But limiting the light to the persons passing by, required to position the lamps on an angle that it was not possible to. On the other hand, limiting the spots to illuminate the canvas would interfere with the projection of the images on the canvas.

The problem when bringing normal lights to the scene, was that even though it allowed to illuminate efficiently the persons and create a bigger contrast, it required to install the floor lamps on the corridor.

These situations led the group to consider building a lighting system from scratch, allowing a tailored solution for the installation and avoiding the problems caused by the previous situations. The most simple way to achieve our purpose was by using a strip of infrared LEDs. It could be placed to light both the canvas and the persons, and create a high contrast between them. Furthermore, it turn out to be a good way to define a region of interest, thus easing the workload of the image processing.

\subsection{Building the LEDs}
For illuminating the scene, several different alternatives were discussed and ultimately IR LEDs were chosen \fxnote{Refer to the chapter in which this is discussed} because of their good illumination outside of the visible spectrum. For the project two different LEDs were tested, both emitting at roughly 880nm \citep{5mm_led} \citep{3mm_led}. A 5mm with a cone of light of 16 degrees\fxnote{source is datasheet} and a 3mm with a cone of light of 130 degrees\fxnote{source is datasheet}.

During initial testing the focussed beam from the 5mm LED looked as though it might be too focussed, making it  difficult to create a bright line of unbroken illumination. For that reason a series of experiments were conducted: A setup that tested the light that the two LEDs offered were constructed and it was apparant that the broader LEDs did not focus the light enough, and thus did not create a high enough illumination, see figure \ref{fig:5_mm_test} and \ref{fig:3_mm_test}. Therefore the choice was made to go with the 5mm, 16 degree LEDs.

\begin{figure}[htbp] \centering
\begin{minipage}[b]{0.45\textwidth} \centering
\includegraphics[width=1.00\textwidth]{Pictures/Theory/5mm.jpg} % Venstre billede
\end{minipage} \hfill
\begin{minipage}[b]{0.45\textwidth} \centering
\includegraphics[width=1.00\textwidth]{Pictures/Theory/3mm.jpg} % Højre billede
\end{minipage} \\ % Captions og labels
\begin{minipage}[t]{0.45\textwidth}
\caption{5mm LED illuminates a sheet, that will later be used for projection.} % Venstre caption og label
\label{fig:5_mm_test}
\end{minipage} \hfill
\begin{minipage}[t]{0.45\textwidth}
\caption{3mm LED illuminates the same sheet.} % Højre caption og label
\label{fig:3_mm_led}
\end{minipage}
\end{figure}

Initially a broader strip of light was thought to be desirable, therefore a test was conducted where the LEDs had their lens sanded down in order to make the light less focussed. Figure \ref{fig:leds_sanded} shows an image where the LEDs in progression from left to right get more and more sanded down. As the figure illustrates the intensity of the light decreases as the LED-lens is sanded down. After conducting these tests,  it became clear that an unaltered LED performed better than the modified ones, providing a more intense illumination.

\begin{figure} [htbp]
\centering
\includegraphics[width=1.00\textwidth]{Pictures/Theory/sanded_leds.jpg}
\caption{The LEDs have been sanded down in progressive order from left to right.}
\label{fig:leds_sanded}
\end{figure}

For ease of construction the LEDs were arranged into arrays of 8 LEDs connected in series, which in turn are connected in parallel. The LEDs have a forward voltage of 1.5V, which means that the power supply has to be able to supply at least 12V to power all 8 of them. Initially a small AC-DC power supply capable of supplying 12V at 600mA was used for testing purposes. However the total draw of a single LED array is 0,5A and for the project a total of 4 arrays were planned. The current far exceeded what could be supplied by the small AC-DC supply. Luckily the group managed to salvage a 300 watt computer power supply capable of supplying 12 volts at 8 amperes. After getting the power supply to work without being in a computer, terminals were soldered to LED-strips and the power supply allowing the LED-strips to plug into the power supply.

