\chapter{Introduction}
\section{Foreword}
Nowadays, images and videos have acquired a big prevalence in our daily life. From the creation of the Camera obscura to the Hubble Space Telescope, it is clear that humans have had the need to capture images but also to use those images for further purposes. But how to make a machine understand what humans can see and process just by looking is a step that has revolutionized our lifes, even though most of us don't even notice it. Something as simple as recycling bottles on the machine in the shop on the corner, is possible by programming that machine so that it will recognize some of the characteristics of that flask and reject it or accept it depending on the information extracted. This can be reached using techniques like Image Processing, where its main purpose is to extract important data from images and videos in order to re-use it for other purposes.

One aspect of Medialogy is building systems that react accordingly to humans, to create a better human-computer confluence. For this semester project, the class was asked to focus less on the problem solving and more on producing an entertaining product or program in which to apply our knowledge on Image Processing and Procedural Programming.


%%%%%%%%%%%%%%%%%%%%%%%% Comments for the introduction - Marta %%%%%%%%%%%%%%%%%%%%%%%%%%
% From my point of view, the introduction should be more focused on the applications of image processing, e.g. a rough explanation of what it is and what is used for in our daily life. It is ok to say that we will be using C++, but I don't see the point on commenting about the subjects that we had this semester.

%One aspect of Medialogy is building systems that react accordingly to humans. There are several technologies and theories that support this. One field in this category is called Visual Computing where Image Processing often is used, e.g. to recognize specific objects and motions. By implementing custom made software, one will be able to monitor a specific target group or process. In addition to this semester project, two mandatory courses on the third semester of Medialogy are of interest to our  project.

%The first course is called Image Processing and it is primarily based on understanding the theory of a picture and tools to manipulate the pixel values within. Knowledge such as the principle of bits and bytes, the RGB color system, histograms, and using thresholds to segment a picture, are some of the tools learned from the course. The second course used for the semester project is Procedural Programming, in which the C++ programming language was taught. The theoretical background for programming is necessary to be able to analyze and manipulate a digital image, based on theory and algorithms learned in Image Processing.

%To structure the semester projects in regards to supervisors and co-supervisors, every group was asked to discuss which subject they wanted to work with. In continuation of this every group had to submit an application for the three subjects of the biggest interest, with first, second and third priority.

The eleven topics presented were:

\begin{itemize}
\item Image Processing for Fun Utilizing an Industrial Robot
\item Image Processing for Ambient Intelligent Robots
\item Interactive Floor
\item Interactive Book
\item Interactive Drawing Game
\item Interactive Arcade Game
\item Emergency system for old people that have fallen
\item Thermal Sock Puppet Show
\item Body Motion Controlled Exercise Game
\item Mobile app for recognizing electric components
\item Hj{\o}rring Library
\end{itemize}

After reading into the different project proposals our group decided which three subjects to apply for:

\begin{enumerate} 
\item Hj{\o}rring Library 
\item Interactive Floor 
\item Image Processing for Ambient Intelligent Robots 
\end{enumerate}

To great delight, the group was chosen to work with Hj{\o}rring Library, which was our first priority.

\section{Establishing a collaboration with Hj{\o}rring Library}
%There were no additional predefined projects, just that it should be some kind of installation that could run at the library - preferably based on a special theme.

%A meeting was arranged with the library travelled to Hj{\o}rring to meet the library staff. Here, the group was let loose in the library to check locations for potential projects. After talking to some of the staff, more specifically our contact person Martin J{\o}rgensen, some general ideas emerged. Afterwards it was decided to go back to the university and do some initial brainstorming based on the library environment.

During the first visit to Hj{\o}rring Library, the groups designated to work there got some instructions of what they were expected to do. Although there were no additional predefined projects, the staff of the library expected to get an installation that could be run there and where the visitors could spend some time interacting with.

The first idea that emerged included scanning barcodes of books in the library. The concept was to place a big canvas on some bookshelves, and whenever people walked past it, they would see their silhouette projected onto the canvas. The idea was that people would explore the library and depending on the books gathered and scanned, some specific graphics would appear on the canvas, like a hat or other clothes related to that theme. An example could be scanning a fairy tale written by H.C. Andersen which would then produce a hat on-top of the user; or maybe a book with Sherlock Holmes would spawn his famous hat and pipe, etcetera. This would allow people that casually walk past the shelves see something interesting on the canvas; and if they want to, they could participate further by going around the library to find the correct books, scan them, and thereby change what would be projected on the canvas next time. Maybe they were told to find a book about dinosaurs, and if they succeed in scanning an arbitrary book containing dinosaurs, everybody walking past the canvas from now on would see themselves with a dinosaur costume. It seemed like a concept with endless possibilities.

After conferencing with the supervisors, it was decided that the concept needed to be narrowed down to something more specific. There were some uncertainties whether it would be possible to make a program that could track people and display graphics on top of them (e.g. a hat), as well as scan barcodes from books and extract some useful data (e.g. book genre, fiction or non-fiction, etc.). Therefore it was suggested to only focus on the first part of the concept, so that instead of trying to do multiple themes we should focus mainly on one, such as fairy tales and hats from this category.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% i am here %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

An email was sent to Martin J{\o}rgensen from Hj{\o}rring Library describing the concept and the location we would like to use: a big bookshelf in the center of the library. Martin liked the idea, but had some concerns to identify the period in which the project would fit the library. Hj{\o}rring Library work around specific topics that change every 8-12 weeks. One of the upcoming themes at the library was Christmas, which runs from the 2nd week of November until the last week of December. Another idea then emerged in the group towards creating a project for December. Instead of working with the H.C. Andersen theme, it was decided to work with Christmas and to add a Christmas hat on top of visitors of the library. Martin was fond of this idea, and so a new meeting was arranged in order to settle on a suitable location for the project.

Two members of the group travelled to Hj{\o}rring to participate in the meeting with Martin. The outcome was a more specific plan on the project concerning:

\begin{itemize}
\item The position of the project
\item The equipment that was desired to borrow
\item The light conditions
\end{itemize}

The position of the canvas was decided to be on the walkway from the reception desk to the core of the library (see figure \ref{fig:concept_art}), which Martin believed would be an ideal position for the project as the light condition is controllable. In addition to that, he knew from experience that people tend to use that walkway either to enter or exit the library, as it is the shortest route. Most importantly, it should be a place that people walk past naturally, instead of having to go out searching to find the canvas.

\begin{figure}[htbp]
\centering
\includegraphics[width=1.00\textwidth]{Pictures/HjoerringLibrary/LocationJohannesHat.jpg}
\caption{A central location for the canvas was chosen to get at Hj{\o}rring Library.}
\label{fig:concept_art}
\end{figure}
Figure \ref{fig:concept_art} illustrates the setup at the library. A canvas with the proportions 3 * 2.25 meters will be positioned directly on the bookshelves seen in the background of the picture.

%\subsection{The initial goal}
%%% All/some of the stuff below can maybe be deleted? - Gustav %%%

%One thing that Martin was interested in was knowing the ambitions for the project and what to expect. There had already been a conversation within the group about the level of ambitions for the project. Considering the knowledge in programming and image processing, being ready to present the prototype in the beginning of December became a part of the initial goal. Previously, Martin told us that the Christmas theme would run from the second week in November until the last week in December; therefore a 3 week run-time period was a desirable goal.

%As for the initial goal, Martin expressed his excitement by letting us know that it was very ambitious, but that we should not be intimidated by this, and that he hoped we would succeed. Furthermore, he let us know that he would like to contact the designer in charge of the exhibitions at the library to create some interesting scenery for the project. Lastly, he expressed that in case we would not succeed to finish the prototype for the beginning of December, and run for the three-week period, he would like to know, so that he could contact the designer and tell her to do some backup exhibition.

\section{Technical point of view}
The basic idea is to have a canvas on which the shade of the person is projected together with the Christmas hat added to the top of the head. For that the following tools are needed:

\begin{itemize}
\item A web camera to gather input about people walking past
\item A computer to run the program code
\item A projector to display the output from the computer
\item A canvas on which the output is projected
\item Controllable light conditions
\item Power, cables, etc.
\end{itemize}

Together with a projector capable of projecting a relatively huge output, 3 * 2.25 meters, the computer running the program code will also be connected to a web cam. A canvas in the above-mentioned size will have to be made and placed on top of the bookshelves.

\subsection{Getting started with a prototype}
The first step into developing the needed software was to write some initial code that would run and produce a useful output. This was done by dividing the group into two smaller groups consisting of three people each, with the goal of coming up with a solution on how to produce a segmentation of a video input. A competition within the group turned up to create the best program code in three days to be presented. And so the "winner's code", or parts from both projects, would be incorporated in a testable file to be elaborated on in the following month.

At the end of the week, two programs were ready to be tested. Both programs were able to do same things, only the code differed. Some of the techniques used were: median filtering; morphology (opening/closing); background subtraction; conversion from a colored image to a grayscale image; and, most importantly, a first draft of the BLOB analysis that is needed to analyze the shape of the head where the Christmas hat is to be placed. All of these concepts are going to be explained more in-depth in chapter \ref{theory_part}.

\subsection{Running the first test}
As the first prototype of the program was completed, it was decided to test the code and the  equipment, to look at the video output, considering the framerate of the video and the threshold values. Figure \ref{fig:ir_cam_test} illustrates the initial setup for the first prototype testing.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.80\textwidth]{Pictures/Test/TestSetup.jpg}
\caption{An early prototype test using temporary equipment.}
\label{fig:ir_cam_test}
\end{figure} 

At first a normal camera was used, but due to changes in the light conditions originating from the objects walking past, which caused glittering on the output, it was decided to use a camera with a an infrared filter. In addition to the infrared camera, four light bulbs were used to illuminate the person properly, so the contrast between background and object became as big as possible. This produced a somewhat good output of the test person, though one problem still remained: once the test person turned 90 degrees, the head became much smaller and didn't look very precise on the output, in addition the Christmas hat would also be misplaced.

The solution to this turned out to be illuminating the background instead of the person, which produced a much better result, as shown in figure \ref{fig:max_subtracted}. The goal was to create as much contrast between foreground/object and background (see figure \ref{fig:max_subtracted}, and since the background is static, it seemed easier to illuminate.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.80\textwidth]{Pictures/Test/MaxSubtracted.jpg}
\caption{Complete background subtraction of object outputted as binary picture. There is also some simple BLOB analysis that looks for the top-most row of pixels (the head) and display a hat at that position.}
\label{fig:max_subtracted}
\end{figure}

\section{Feedback from co-supervisor}
The 14th of November a meeting was arranged with the co-supervisor Andreas M{\o}gelmose. The meeting was initiated to receive some valuable feedback on the prototype test, as well as help with some programming dilemmas regarding speed and efficiency due to the amount of pixels needed to loop through in the program.\\
Various suggestions were given, such as adjusting the BLOB analysis to a more specified point of interest, as well as some tips on how to optimize the background subtraction.

After the meeting with Andreas, some changes were made to the concept. It was decided that, considering the new information gathered, to take the project in a slightly different direction.

\subsection{Using Christmas characters instead of showing the full body}
Previously, the group imagined the program to display the whole person as the output with a graphical hat on top. Later it was suggested to not show the person directly, but instead show some kind of shadow figure. Both approaches seemed to cause problems, since the program would have to loop through the whole image to find the person and then do some calculations. Even with only a single person, as in the prototype test, this seemed to be a very slow process. Since the group wanted to track multiple people, it didn't work as intended. This dilemma was brought up on the meeting with the co-supervisor. It was suggested not to take the person's full body, but instead only look for the head.

Instead of outputting the entire input image (the person itself) and performing several image operations, it was chosen to limit the amount of data used to find the person. Instead of looking at the whole shape, the program should only look for the head. Then it would display some pre-drawn characters underneath the head, e.g. a visitor at the library doesn't see himself, but instead a funny Christmas-themed character running around on the screen.

This would save a lot of calculations, so only the head of the user is of interest to analyze. Hopefully this would lead to a more stable framerate for the program, which is important to create the proper immersion. It is important that the camera is quick enough to pick up and recognize new people stepping into the scene.

Another aspect to have in mind is that some people don't like to see themselves portrayed on a screen; they feel it is intimidating. By having drawn characters instead this is avoided. Also, this would allow for more consistent artstyle.
  
\section{Vision and success criteria}
The vision for the project is to make a simple, yet working, program that is fun and engaging to use at Hj{\o}rring Library. It should be something you can just walk past once and get something fun out of it, or, if you stay for a little longer, you can interact with it even more. It is not meant as a game per se, but more like an interactive playground where you can move around and have a good time. Also, the program should be fairly self-maintained and independent, meaning that little maintenance work is needed from the staff of the library.

Based on above-mentioned goals of engaging people at the library, the initial vision of this semester project is to engage visitors, both passively and actively. Ultimately, the final problem statement ended being as shown in \ref{problemStatement}.

The group decided that it wanted to make everything from scratch, i.e. not use any existing functionality. However, since the OpenCV library was taught in the Procedural Programming course, as well as the C++ programming language, it seemed appropriate to use it load basic pixel information from digital images. OpenCV provides a lot of useful functionality that could easily be used for this project, such as applying filters and looking for BLOBs, but it was chosen not to use any of those functions, but instead write the code ourselves. This means that even though the program is going to be slower in overall terms, we don't rely on any third party functionality.

\subsection{Problem statement}\label{problemStatement}
\textbf{Is it possible to make an interactive piece of software that fits into the environment of Hj{\o}rring Library? The program should meet the following sets of requirements:}

\begin{itemize}
\item Low maintenance: the program should be easy set up and use for the library staff.
\item Fits with the theme of Hj{\o}rring Library during December: Christmas. The program should be ready for the beginning of December.
\item It should be engaging for short periods of time, as well as for multiple uses. Multiple people should be able to use it simultaneously.
\item The program would be written in C++ and using the OpenCV library for reading/writing images, but all of the image processing functionality should be written by the group.
\end{itemize}